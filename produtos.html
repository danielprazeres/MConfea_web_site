<!DOCTYPE html>
<html lang="pt-PT">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>M Conf&A - Produtos</title>
  <meta name="description" content="Explore nossa linha de produtos de climatização, automação residencial e energia sustentável.">
  <meta name="keywords" content="ar condicionado, bombas de calor, termo híbrido, termo elétrico, climatização, automação residencial">
  <meta name="robots" content="index, follow">

  <!-- Favicons -->
  <link href="assets/img/logo.png" rel="icon">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  <link href="assets/css/pagination.css" rel="stylesheet">

</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header d-flex align-items-center">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="M Conf&A">
      </a>
      <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
      <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>
      <nav id="navbar" class="navbar">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="produtos.html" class="active">Produtos</a></li>
          <li><a href="contact.html">Contacto</a></li>
        </ul>
      </nav>
    </div>
  </header><!-- End Header -->

  <!-- ======= Breadcrumbs ======= -->
  <div class="breadcrumbs d-flex align-items-center" style="background-image: url('assets/img/breadcrumbs-bg.jpg');">
    <div class="container position-relative d-flex flex-column align-items-center" data-aos="fade">
      <h2>Produtos</h2>
      <ol>
        <li><a href="index.html">Home</a></li>
        <li>Produtos</li>
      </ol>
    </div>
  </div><!-- End Breadcrumbs -->

  <!-- ======= Products Section ======= -->
  <section id="products" class="products">
    <div class="container" data-aos="fade-up">

      <div class="section-header">
        <h2>Nossos Produtos</h2>
        <p>Explore nossas soluções de climatização, automação e energia sustentável.</p>
      </div>

      <!-- Barra de pesquisa -->
      <div class="row mb-4">
        <div class="col-lg-12 d-flex">
          <input type="text" id="search-bar" class="form-control me-2" placeholder="Pesquisar produtos por nome, categoria ou descrição..." onkeypress="handleKeyPress(event)">
          <button class="btn btn-primary" onclick="searchProducts()">
            <i class="bi bi-search"></i>
          </button>
          <button class="btn btn-secondary ms-2" onclick="clearSearch()">Limpar</button>
        </div>
      </div>

      <div class="row gy-4" id="product-list">
        <!-- Os produtos serão carregados aqui dinamicamente -->
      </div>

      <!-- Paginação -->
      <div class="row">
        <div class="col-12 text-center mt-4">
          <nav class="d-inline-block">
            <ul class="pagination" id="pagination">
              <!-- Links de paginação serão inseridos dinamicamente -->
            </ul>
          </nav>
        </div>
      </div>

    </div>
  </section><!-- End Products Section -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="footer-legal text-center position-relative">
      <div class="container">
        <div class="copyright">
          &copy; Copyright <strong><span>M Conf&A</span></strong>. Todos os direitos reservados.
        </div>
      </div>
    </div>
  </footer><!-- End Footer -->

  <!-- Botão flutuante do WhatsApp -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <a href="https://wa.me/351913632248?text=Olá! Vi seu site e gostaria de mais informações."
    style="position:fixed;width:60px;height:60px;bottom:40px;right:40px;background-color:#25d366;color:#FFF;border-radius:50px;text-align:center;font-size:30px;box-shadow: 1px 1px 2px #888; z-index:1000;"
    target="_blank">
    <i style="margin-top:16px" class="fa fa-whatsapp"></i>
  </a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- Script para carregar produtos dinamicamente -->
  <script>
    const itemsPerPage = 9; // Produtos por página
    let currentPage = 1;
    let allProducts = [];
    let originalProducts = [];
    let filteredProducts = []; // Nova variável para armazenar produtos filtrados
    let isSearching = false; // Indica se estamos realizando uma busca

    // Carrega os produtos
    function loadProducts() {
      fetch("assets/data/produtos.json")
        .then(response => response.json())
        .then(produtos => {
          allProducts = produtos;
          originalProducts = [...produtos];
          filteredProducts = [...produtos]; // Inicialmente, a lista filtrada é igual à original
          renderProducts();
          renderPagination();
        })
        .catch(error => console.error("Erro ao carregar produtos:", error));
    }

    // Renderiza os produtos com base na página atual
    function renderProducts() {
      const productList = document.getElementById('product-list');
      productList.innerHTML = '';

      // Define a lista de produtos com base na busca ou exibição padrão
      const productsToDisplay = isSearching ? filteredProducts : originalProducts;

      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const productsToShow = productsToDisplay.slice(startIndex, endIndex);

      productsToShow.forEach(produto => {
        const productItem = document.createElement('div');
        productItem.className = 'col-lg-4 col-md-6';
        productItem.innerHTML = `
          <div class="col-lg-4 col-md-6">
              <div class="card h-100">
                  <img src="${produto.pasta}${produto.imagens[0]}" class="card-img-top" alt="${produto.nome}">
                  <div class="card-body">
                      <h5 class="card-title">${produto.nome}</h5>
                      <p class="card-text">${produto.descricao}</p>
                      <p class="text-muted"><small>${produto.categoria} > ${produto.subcategoria}</small></p>
                      <p class="text-muted"><strong>Fabricante:</strong> ${produto.empresa}</p>
                      <a href="produto-detalhes.html?id=${produto.id}" class="btn btn-primary">Saber Mais</a>
                  </div>
              </div>
          </div>
        `;
        productList.appendChild(productItem);
      });
    }

    // Renderiza os links de paginação
    function renderPagination() {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';

      // Define a lista correta para paginação (produtos filtrados ou todos)
      const productsToPaginate = isSearching ? filteredProducts : originalProducts;
      const totalPages = Math.ceil(productsToPaginate.length / itemsPerPage);

      for (let i = 1; i <= totalPages; i++) {
        const pageItem = document.createElement('li');
        pageItem.className = 'page-item ' + (i === currentPage ? 'active' : '');
        pageItem.innerHTML = `<a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>`;
        pagination.appendChild(pageItem);
      }
    }

    // Função para mudar de página
    function goToPage(pageNumber) {
      currentPage = pageNumber;
      renderProducts();
      renderPagination();
    }

    // Função de busca acionada pelo botão ou Enter
    function searchProducts() {
      const query = document.getElementById('search-bar').value.toLowerCase().trim();
      
      if (query === '') {
        clearSearch(); // Se a pesquisa estiver vazia, volta para a exibição normal
        return;
      }

      isSearching = true; // Indica que a pesquisa está ativa

      // Filtra os produtos com base na pesquisa
      filteredProducts = originalProducts.filter(produto =>
        produto.nome.toLowerCase().includes(query) ||
        produto.descricao.toLowerCase().includes(query) ||
        produto.categoria.toLowerCase().includes(query) ||
        produto.subcategoria.toLowerCase().includes(query)
      );

      currentPage = 1; // Sempre volta para a primeira página ao buscar
      renderProducts();
      renderPagination();
    }

    // Limpa a pesquisa e restaura os produtos
    function clearSearch() {
      document.getElementById('search-bar').value = '';
      isSearching = false; // Indica que a pesquisa não está mais ativa
      filteredProducts = [...originalProducts]; // Restaura a lista original
      currentPage = 1;
      renderProducts();
      renderPagination();
    }

    // Dispara a pesquisa ao pressionar Enter
    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        searchProducts();
      }
    }

    document.addEventListener("DOMContentLoaded", loadProducts);
  </script>

</body>

</html>